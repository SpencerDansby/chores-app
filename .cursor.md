# Cursor AI Development Workflow

This document outlines the development workflow for this project, with emphasis on using Playwright MCP for verification and testing.

## Core Requirements

**For every task completion:**

1. **Verify it works** - Use Playwright MCP to manually verify the changes in the browser
2. **Run tests** - Execute `pnpm test` to ensure no regressions
3. **TypeScript check** - Execute `pnpm typecheck` to verify no TypeScript errors
4. **Add tests** - If the task adds new functionality, create corresponding Playwright tests

These steps are mandatory before marking any task as complete.

## TypeScript Rules

**Strict Type Safety:**
- **NO `any` types allowed** - Use proper types, `unknown`, or type guards instead
- Use `ts-toolbelt` and `ts-essentials` for advanced type utilities
- All functions must have explicit return types
- Run `pnpm typecheck` before completing any task

## Playwright MCP Verification Workflow

After completing each development task, use Playwright MCP to verify functionality before moving to the next task. This ensures visual confirmation and catches issues early.

### Prerequisites

1. **Expo Web Server Running**: Start the Expo web server before verification
   ```bash
   pnpm web
   # or
   npm run web
   ```
   The app should be accessible at `http://localhost:8081` (default Expo web port)

2. **Playwright MCP Configured**: Ensure Playwright MCP server is configured in Cursor settings

### Verification Steps

For each completed task, follow these steps:

#### 1. Navigate to the App
```typescript
// Use browser_navigate to open the app
browser_navigate({ url: "http://localhost:8081" })
```

#### 2. Take a Snapshot
```typescript
// Use browser_snapshot to see the current page state
browser_snapshot({ take_screenshot_afterwards: true })
```

This provides:
- Accessibility tree of the page
- Element references for interaction
- Visual confirmation via screenshot

#### 3. Verify Elements Are Visible
Use the snapshot to identify elements and verify they're present:
- Check for expected text content
- Verify interactive elements (buttons, inputs, links)
- Confirm layout and styling

#### 4. Test Interactions
Use Playwright MCP tools to interact with elements:

**Click Elements:**
```typescript
browser_click({ 
  element: "Login button", 
  ref: "<element-ref-from-snapshot>" 
})
```

**Type in Inputs:**
```typescript
browser_type({ 
  element: "Email input", 
  ref: "<element-ref-from-snapshot>",
  text: "test@example.com" 
})
```

**Fill Forms:**
```typescript
browser_fill_form({
  fields: [
    { element: "Email", ref: "<ref>", value: "test@example.com" },
    { element: "Password", ref: "<ref>", value: "password123" }
  ]
})
```

#### 5. Verify Navigation
After interactions that should navigate:
- Wait for navigation: `browser_wait_for({ text: "Expected page content" })`
- Take a new snapshot to verify the new page loaded
- Confirm URL changed if applicable

#### 6. Run Automated Tests
After visual verification, run the test suite:
```bash
pnpm test
# or for UI mode
pnpm test:ui
```

#### 7. Create or Update Tests
If verification reveals:
- **Missing functionality**: Create tests to cover it
- **Bugs**: Create tests that reproduce the bug, then fix
- **Edge cases**: Add tests for edge cases discovered during verification

### Task-Specific Verification

#### After Installing Dependencies
- Verify `package.json` includes new dependencies
- Check `node_modules` exists (if applicable)
- Verify no installation errors

#### After Creating Configuration Files
- Verify file exists and has correct structure
- Test configuration by running related commands
- Use Playwright MCP to verify app is accessible

#### After Creating Test Files
- Run the specific test file: `pnpm test tests/navigation.spec.ts`
- Use Playwright MCP to manually verify what the test covers
- Ensure test passes and matches manual verification

#### After Creating Components/Pages
- Navigate to the page/component using Playwright MCP
- Verify all elements render correctly
- Test all interactive elements
- Verify navigation (if applicable)
- Create tests for the new functionality

#### After Updating Existing Code
- Navigate to affected pages
- Verify changes are visible and functional
- Run existing tests to ensure no regressions
- Update tests if behavior changed intentionally

### Common Playwright MCP Patterns

#### Pattern: Verify Page Loads
```typescript
browser_navigate({ url: "http://localhost:8081" })
browser_wait_for({ text: "TaskQuest" }) // Wait for key content
browser_snapshot({ take_screenshot_afterwards: true })
```

#### Pattern: Test Form Submission
```typescript
browser_navigate({ url: "http://localhost:8081" })
browser_snapshot() // Get element refs
browser_fill_form({
  fields: [
    { element: "Email input", ref: "<email-ref>", value: "test@example.com" },
    { element: "Password input", ref: "<password-ref>", value: "password" }
  ]
})
browser_click({ element: "Login button", ref: "<login-ref>" })
browser_wait_for({ text: "Who's using TaskQuest?" }) // Wait for next page
browser_snapshot({ take_screenshot_afterwards: true })
```

#### Pattern: Test Navigation Flow
```typescript
// Start at login
browser_navigate({ url: "http://localhost:8081" })
browser_click({ element: "Login button", ref: "<ref>" })
browser_wait_for({ text: "Who's using TaskQuest?" })

// Navigate to PIN
browser_snapshot()
browser_click({ element: "Mom profile", ref: "<mom-ref>" })
browser_wait_for({ text: "Welcome back, Sarah" })

// Test back navigation
browser_snapshot()
browser_click({ element: "Back button", ref: "<back-ref>" })
browser_wait_for({ text: "Who's using TaskQuest?" })
browser_snapshot({ take_screenshot_afterwards: true })
```

### Best Practices

1. **Always verify visually first**: Use Playwright MCP to see what's happening
2. **Then automate**: Create tests based on what you verified manually
3. **Test user journeys**: Focus on complete flows, not just individual components
4. **Use accessibility-first**: Playwright MCP uses accessibility trees - leverage this
5. **Take screenshots**: Use `take_screenshot_afterwards: true` for visual confirmation
6. **Wait for content**: Use `browser_wait_for` instead of fixed delays
7. **Verify after changes**: Don't skip verification even for small changes

### Troubleshooting

**App not accessible:**
- Ensure Expo web server is running: `pnpm web`
- Check the port (default is 8081)
- Verify no errors in Expo output

**Elements not found:**
- Take a fresh snapshot to get current element refs
- Check if page fully loaded (use `browser_wait_for`)
- Verify element is visible (may need to scroll or wait)

**Tests failing:**
- Use Playwright MCP to manually verify the same flow
- Compare manual verification with test expectations
- Check if timing issues (add appropriate waits)
- Verify selectors match actual elements

### Integration with Development Tasks

When working on tasks:

1. **Before starting**: Understand what needs to be verified
2. **During development**: Use Playwright MCP to check progress
3. **After completion**: Follow full verification workflow
4. **Before committing**: Ensure all tests pass and manual verification succeeds

This workflow ensures:
- ✅ Visual confirmation of functionality
- ✅ Automated test coverage
- ✅ Early bug detection
- ✅ Confidence in changes before moving forward
